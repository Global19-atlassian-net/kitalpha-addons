<?xml version="1.0" encoding="UTF-8"?>
<!--
This file was generated by Eclipse EGF
-->
<project name="project" default="all">
    <property environment="env" />

	<property name="relengDir" value="${basedir}"/>
	<tstamp>
		<format property="myTimestamp" pattern="yyyyMMdd-HHmm"/>
	</tstamp>

    <condition property="build.root" value="${env.WORKSPACE}">
        <isset property="env.WORKSPACE" />
    </condition>
    <condition property="tools" value="${env.tools}">
        <isset property="env.tools" />
    </condition>
    <condition property="result" value="${env.result}">
        <isset property="env.result" />
    </condition>
    <condition property="publish" value="${env.publish}">
        <isset property="env.publish" />
    </condition>
    <condition property="workspace" value="${env.ECLIPSE_WORKSPACE}">
        <isset property="env.ECLIPSE_WORKSPACE" />
    </condition>
    <condition property="timestamp" value="${env.BUILD_ID}">
        <isset property="env.BUILD_ID" />
    </condition>
    <condition property="buildVersion" value="${env.buildVersion}">
        <isset property="env.buildVersion" />
    </condition>
    <condition property="Kitalpha_Version" value="${env.Kitalpha_Version}">
        <isset property="env.Kitalpha_Version" />
    </condition>
    <condition property="eclipse_version" value="${env.eclipse_version}">
        <isset property="env.eclipse_version" />
    </condition>
    <condition property="TP_URL" value="${env.TP_URL}">
        <isset property="env.TP_URL" />
    </condition>
    <condition property="rcptt.url" value="${env.rcptt.url}">
        <isset property="env.rcptt.url" />
    </condition>
    <condition property="jacoco.url" value="${env.jacoco.url}">
        <isset property="env.jacoco.url" />
    </condition>

    <property file="build.properties" />

    <!-- This macro executes the default application of an eclipse installation that resides
         in the folder ${buildtools}/@app
      -->
    <macrodef name="eclipse.launch">
        <attribute name="app" />
        <attribute name="workspace" default="${workspace}" />
        <element name="args" optional="true" />
        <sequential>
            <!-- We assume that the eclipse installation is beneath ${tools} -->
            <property name="@{app}.deploy.dir" value="${tools}/@{app}" />

            <!-- Find the Eclipse launcher and assing its location to the @{app}.launcher property -->
            <pathconvert property="@{app}.launcher">
                <first count="1">
                    <sort>
                        <fileset dir="${@{app}.deploy.dir}/plugins" includes="**/org.eclipse.equinox.launcher_*.jar" />
                        <reverse xmlns="antlib:org.apache.tools.ant.types.resources.comparators">
                            <date />
                        </reverse>
                    </sort>
                </first>
            </pathconvert>

			<!-- Copy Eclipse Variables preferences -->
			<copy file="${relengDir}/templates/org.eclipse.core.variables.prefs"
				toFile="@{workspace}/.metadata/.plugins/org.eclipse.core.runtime/.settings/org.eclipse.core.variables.prefs"/>

            <!-- Launch the eclipse application -->
            <java fork="true" jar="${@{app}.launcher}" dir="${@{app}.deploy.dir}" failonerror="true">
                    <jvmarg value="-Xmx1024m"/>
                    <jvmarg value="-XX:MaxPermSize=256m"/>

	                <jvmarg value="-DrelengDir=relengDir"/>
	                <jvmarg value="-Dbuild.root=${build.root}"/>
	                <jvmarg value="-Dtools=${tools}"/>
	                <jvmarg value="-Dresult=${result}"/>
	                <jvmarg value="-Dpublish=${publish}"/>
	                <jvmarg value="-Dworkspace=${workspace}"/>
	                <jvmarg value="-Dtimestamp=${timestamp}"/>
	                <jvmarg value="-DbuildVersion=${buildVersion}"/>
	                <jvmarg value="-DKitalpha_Version=${Kitalpha_Version}"/>
	                <jvmarg value="-Declipse_version=${eclipse_version}"/>
	                <jvmarg value="-DTP_URL=${TP_URL}"/>
	                <jvmarg value="-Drcptt.url=${rcptt.url}"/>
	                <jvmarg value="-Djacoco.url=${jacoco.url}"/>
                    <arg value="-data" />
                    <arg value="@{workspace}" />
                <args />
            </java>
        </sequential>
    </macrodef>
    <target name="install.director">
        <available file="${tools}/director/director" property="director.exists" />
        <antcall target="do.install.director" />
    </target>
    
    <target name="do.install.director" unless="director.exists">
        <echo message="Fetching headless director application" />
        <tempfile destdir="${java.io.tmpdir}" prefix="director-" suffix=".zip" property="director.zip" deleteonexit="true" />
        <get src="${director.url}" dest="${director.zip}" />
        <mkdir dir="${tools}" />
        <unzip src="${director.zip}" dest="${tools}" />
        <delete file="${director.zip}" />
    </target>
    <target name="install.buckminster">
        <available file="${tools}/buckminster/buckminster" property="buckminster.exists" />
        <antcall target="do.install.buckminster" />
	</target>
	
    <target name="do.install.buckminster" unless="buckminster.exists" depends="install.director">
        <echo message="Configuring headless buckminster with needed features" />
        <echo message="Headless site: ${bm.headless.site}" />
        <echo message="External site: ${bm.external.site}" />
        <eclipse.launch app="director">
            <args>
                <jvmarg value="-Declipse.p2.mirrors=false" />
                <arg value="-r" />
                <arg value="${bm.headless.site}" />
                <arg value="-r" />
                <arg value="${bm.external.site}" />
                <arg value="-r" />
                <arg value="${polarion.site}" />
                <arg value="-d" />
                <arg value="${tools}/buckminster" />
                <arg value="-p" />
                <arg value="Buckminster" />
                <arg value="-i" />
                <arg value="org.eclipse.buckminster.cmdline.product" />
                <arg value="-i" />
                <arg value="org.eclipse.buckminster.core.headless.feature.feature.group" />
                <arg value="-i" />
                <arg value="org.eclipse.buckminster.pde.headless.feature.feature.group" />
                <arg value="-i" />
                <arg value="org.eclipse.buckminster.emma.headless.feature.feature.group" />
            </args>
        </eclipse.launch>
    </target>
    <target name="install.egf">
        <available file="${tools}/egf/eclipse.ini" property="egf.exists" />
        <antcall target="do.install.egf" />
	</target>

	<target name="do.install.egf" unless="egf.exists" depends="install.director">
        <echo message="Configuring EGF with needed features" />
        <echo message="EGF site: ${egf.site}" />
        <echo message="EGF eclipse site: ${egf.eclipse.site}" />
        <eclipse.launch app="director">
            <args>
                <jvmarg value="-Declipse.p2.mirrors=false" />
                <arg value="-r" />
                <arg value="${egf.site}" />
                <arg value="-r" />
                <arg value="${egf.eclipse.site}" />
                <arg value="-d" />
                <arg value="${tools}/egf" />
                <arg value="-p" />
                <arg value="EGF" />
                <arg value="-i" />
                <arg value="org.eclipse.platform.ide" />
                <arg value="-i" />
                <arg value="org.eclipse.egf.feature.group" />
                <arg value="-i" />
                <arg value="org.eclipse.egf.portfolio.feature.group" />
                <arg value="-i" />
                <arg value="org.eclipse.egf.portfolio.emf.feature.group" />
                <arg value="-i" />
                <arg value="org.eclipse.egf.portfolio.genchain.feature.group" />
            </args>
        </eclipse.launch>
    </target>
    <macrodef name="buckminster">
        <attribute name="command" />
        <element name="globargs" optional="true" />
        <element name="cmdargs" optional="true" />
        <sequential>
            <eclipse.launch app="buckminster">
                <args>
                    <jvmarg value="-Dbugfix.288796=true"/>
                    <arg value="--loglevel" />
                    <arg value="${buckminster.loglevel}" />
                    <arg value="--displaystacktrace" />
                    <globargs />
                    <arg value="@{command}" />
                    <arg value="-P" />
                    <arg value="${properties.tmp}" />
                    <cmdargs />
                </args>
            </eclipse.launch>
        </sequential>
    </macrodef>
	<macrodef name="egf">
        <attribute name="workspace" default="${workspace}" />
        <element name="activities" />
        <element name="globargs" optional="true" />
        <element name="cmdargs" optional="true" />
        <sequential>
            <eclipse.launch app="egf">
                <args>
                    <arg value="-application" />
                    <arg value="org.eclipse.egf.application.activity" />
                    <arg value="-consoleLog" />
                    <arg value="-data" />
                    <arg value="@{workspace}" />
                    <globargs />
                    <arg value="-runtime" />
                    <arg value="-activities" />
                    <activities />
                    <cmdargs />
                </args>
            </eclipse.launch>
        </sequential>
    </macrodef>	<macrodef name="anteclipse">
        <attribute name="buildfile" default="${relengDir}/build.xml" />
        <attribute name="target" />
        <element name="globargs" optional="true" />
        <sequential>
            <eclipse.launch app="egf">
                <args>
					<arg value="-application" />
					<arg value="org.eclipse.ant.core.antRunner" />
					<arg value="-consoleLog" />
                    <globargs />
					<arg value="-buildfile" />
					<arg value="@{buildfile}" />
					<arg value="@{target}" />
                </args>
            </eclipse.launch>
        </sequential>
    </macrodef>
    <target name="clean.result">
        <delete dir="${result}" failonerror="true" quiet="true" />
    </target>

    <target name="clean.workspace">
        <delete dir="${workspace}" failonerror="true" quiet="true" />
    </target>

    <target name="clean.tools">
        <delete dir="${tools}" failonerror="true" quiet="true" />
    </target>

    <target name="clean.all">
		<antcall target="clean.workspace" />
		<antcall target="clean.result" />
		<antcall target="clean.tools" />
    </target>
	<target name="init" depends="init.build.properties" >
		<echo message="Available variables are : "/>
		<echo message="Builtin $${relengDir} : ${relengDir}" />
		<echo message="Builtin $${build.root} : ${build.root}" />
		<echo message="Builtin $${tools} : ${tools}" />
		<echo message="Builtin $${result} : ${result}" />
		<echo message="Builtin $${publish} : ${publish}" />
		<echo message="Builtin $${workspace} : ${workspace}" />
		<echo message="Builtin $${timestamp} : ${timestamp}" />
		<echo message="Provided $${buildVersion} : ${buildVersion}" />
		<echo message="Provided $${Kitalpha_Version} : ${Kitalpha_Version}" />
		<echo message="Provided $${eclipse_version} : ${eclipse_version}" />
		<echo message="Provided $${TP_URL} : ${TP_URL}" />
		<echo message="Provided $${rcptt.url} : ${rcptt.url}" />
		<echo message="Provided $${jacoco.url} : ${jacoco.url}" />
	</target>

    <target name="init.build.properties">
        <!-- Echo relevant properties to a temporary file so that Buckminster can read them -->
        <tempfile destdir="${java.io.tmpdir}" prefix="build-" suffix=".properties" deleteonexit="true" property="properties.tmp" />
        <echoproperties destfile="${properties.tmp}">
            <!-- We don't want these. basedir in particular will cause problems if passed explicitly -->
            <propertyset negate="true">
                <propertyref name="basedir" />
                <propertyref name="eclipse.home" />
                <propertyref name="properties.tmp" />
                <propertyref name="line.separator" />
                <propertyref name="path.separator" />
                <propertyref prefix="ant." />
                <propertyref prefix="file." />
                <propertyref prefix="java." />
                <propertyref prefix="sun." />
                <propertyref prefix="user." />
            </propertyset>
        </echoproperties>
    </target>
	
	<target name="all" depends="Download_TP,Platform_Model_Step,Platform_Introspector_Step,Rotative_Image_Step,Platform_Modeler_Step,Platform_GenDoc_Step,Packaging_All_in_one,Clean" />
	<target name="Download_TP" depends="Download_TP_CleanStep_1,Download_TP_Create_Folder_download,Download_TP_download_TP" />
	<target name="Platform_Model_Step" depends="Platform_Model_Step_Build_Platform_Model,Platform_Model_Step_Publish_Platform_Model,Platform_Model_Step_Platform_Model" />
	<target name="Platform_Introspector_Step" depends="Platform_Introspector_Step_Build_Plaform_Introspector,Platform_Introspector_Step_Publish_Platform_Introspector,Platform_Introspector_Step_Publish_Platform_Introspector_UI,Platform_Introspector_Step_Aggregate_Platform_Introspector,Platform_Introspector_Step_Platform_Introspector" />
	<target name="Rotative_Image_Step" depends="Rotative_Image_Step_Rotative_Image,Rotative_Image_Step_Publish_Rotative_Image" />
	<target name="Platform_Modeler_Step" depends="Platform_Modeler_Step_Build_Plaform_Modeler,Platform_Modeler_Step_Publish_Platform_Modeler,Platform_Modeler_Step_Platform_Modeler" />
	<target name="Platform_GenDoc_Step" depends="Platform_GenDoc_Step_Build_Plaform_GenDoc,Platform_GenDoc_Step_Publish_Platform_GenDoc_,Platform_GenDoc_Step_Publish_Platform_GenDoc_UI,Platform_GenDoc_Step_Aggregate_Platform_DocGen,Platform_GenDoc_Step_Platform_DocGen" />
	<target name="Packaging_All_in_one" depends="Packaging_All_in_one_All_in_one,Packaging_All_in_one_All_in_One" />
	<target name="Clean" depends="Clean_Delete_TP,Clean_Delete_Packaging_Platform_DocGen,Clean_Delete_Packaging_Platform_Introspector,Clean_Delete_Packaging_All_in_one,Clean_Delete_download_folder,Clean_Delete_TP_Unzip" />
	<target name="Download_TP_CleanStep_1" >
		<antcall target="clean.result" />
	</target>
    <target name="Platform_Model_Step_Build_Platform_Model" depends="init,install.buckminster">
        <echo message="Importing projects into workspace ${workspace} and binaries into target platform" />

		<echo message="install JRE ${env.JAVA_HOME}" />
    	<buckminster command="installJRE">
            <cmdargs>
                <arg value="--location" />
                <arg value="${env.JAVA_HOME}" />
            </cmdargs>
        </buckminster>


		<echo message="import target platform" />
        <buckminster command="importtargetdefinition">
            <cmdargs>
                <arg value="--active" />
                <arg value="${relengDir}/buckminster_Platform_Model_Step_Build_Platform_Model/build.target" />
            </cmdargs>
        </buckminster>
		<echo message="provision : import projects in workspace" />
        <buckminster command="import">
            <!-- Uncomment to debug <globargs><jvmarg value="-agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=y"/></globargs> -->
            <cmdargs>
                <arg value="${relengDir}/buckminster_Platform_Model_Step_Build_Platform_Model/build.mspec" />
            </cmdargs>
        </buckminster>


        <available file="${tools}/egf/eclipse.ini" property="egf.exists_Platform_Model_Step_Build_Platform_Model" />
		<antcall target="recompile_egf_patterns_Platform_Model_Step_Build_Platform_Model" />
		
        <echo message="Invoking all eclipse builders on workspace ${workspace}" />
        <buckminster command="build" >
            <cmdargs>
                <arg value="--clean" />
                <arg value="--thorough" />
            </cmdargs>
		</buckminster>
    </target>

	<target name="recompile_egf_patterns_Platform_Model_Step_Build_Platform_Model" if="egf.exists_Platform_Model_Step_Build_Platform_Model" >
		<anteclipse target="do_recompile_egf_patterns_Platform_Model_Step_Build_Platform_Model" />
	</target>

	<target name="do_recompile_egf_patterns_Platform_Model_Step_Build_Platform_Model" >
        <echo message="Invoking EGF Pattern Builder on workspace ${workspace}" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.jdt.core.javabuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.ManifestBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.SchemaBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.egf.pattern.ui.PatternBuilder" />
	</target>


    <target name="Platform_Introspector_Step_Build_Plaform_Introspector" depends="init,install.buckminster">
        <echo message="Importing projects into workspace ${workspace} and binaries into target platform" />

		<echo message="install JRE ${env.JAVA_HOME}" />
    	<buckminster command="installJRE">
            <cmdargs>
                <arg value="--location" />
                <arg value="${env.JAVA_HOME}" />
            </cmdargs>
        </buckminster>


		<echo message="import target platform" />
        <buckminster command="importtargetdefinition">
            <cmdargs>
                <arg value="--active" />
                <arg value="${relengDir}/buckminster_Platform_Introspector_Step_Build_Plaform_Introspector/build.target" />
            </cmdargs>
        </buckminster>
		<echo message="provision : import projects in workspace" />
        <buckminster command="import">
            <!-- Uncomment to debug <globargs><jvmarg value="-agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=y"/></globargs> -->
            <cmdargs>
                <arg value="${relengDir}/buckminster_Platform_Introspector_Step_Build_Plaform_Introspector/build.mspec" />
            </cmdargs>
        </buckminster>


        <available file="${tools}/egf/eclipse.ini" property="egf.exists_Platform_Introspector_Step_Build_Plaform_Introspector" />
		<antcall target="recompile_egf_patterns_Platform_Introspector_Step_Build_Plaform_Introspector" />
		
        <echo message="Invoking all eclipse builders on workspace ${workspace}" />
        <buckminster command="build" >
            <cmdargs>
                <arg value="--clean" />
                <arg value="--thorough" />
            </cmdargs>
		</buckminster>
    </target>

	<target name="recompile_egf_patterns_Platform_Introspector_Step_Build_Plaform_Introspector" if="egf.exists_Platform_Introspector_Step_Build_Plaform_Introspector" >
		<anteclipse target="do_recompile_egf_patterns_Platform_Introspector_Step_Build_Plaform_Introspector" />
	</target>

	<target name="do_recompile_egf_patterns_Platform_Introspector_Step_Build_Plaform_Introspector" >
        <echo message="Invoking EGF Pattern Builder on workspace ${workspace}" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.jdt.core.javabuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.ManifestBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.SchemaBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.egf.pattern.ui.PatternBuilder" />
	</target>


    <target name="Rotative_Image_Step_Rotative_Image" depends="init,install.buckminster">
        <echo message="Importing projects into workspace ${workspace} and binaries into target platform" />

		<echo message="install JRE ${env.JAVA_HOME}" />
    	<buckminster command="installJRE">
            <cmdargs>
                <arg value="--location" />
                <arg value="${env.JAVA_HOME}" />
            </cmdargs>
        </buckminster>


		<echo message="import target platform" />
        <buckminster command="importtargetdefinition">
            <cmdargs>
                <arg value="--active" />
                <arg value="${relengDir}/buckminster_Rotative_Image_Step_Rotative_Image/build.target" />
            </cmdargs>
        </buckminster>
		<echo message="provision : import projects in workspace" />
        <buckminster command="import">
            <!-- Uncomment to debug <globargs><jvmarg value="-agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=y"/></globargs> -->
            <cmdargs>
                <arg value="${relengDir}/buckminster_Rotative_Image_Step_Rotative_Image/build.mspec" />
            </cmdargs>
        </buckminster>


        <available file="${tools}/egf/eclipse.ini" property="egf.exists_Rotative_Image_Step_Rotative_Image" />
		<antcall target="recompile_egf_patterns_Rotative_Image_Step_Rotative_Image" />
		
        <echo message="Invoking all eclipse builders on workspace ${workspace}" />
        <buckminster command="build" >
            <cmdargs>
                <arg value="--clean" />
                <arg value="--thorough" />
            </cmdargs>
		</buckminster>
    </target>

	<target name="recompile_egf_patterns_Rotative_Image_Step_Rotative_Image" if="egf.exists_Rotative_Image_Step_Rotative_Image" >
		<anteclipse target="do_recompile_egf_patterns_Rotative_Image_Step_Rotative_Image" />
	</target>

	<target name="do_recompile_egf_patterns_Rotative_Image_Step_Rotative_Image" >
        <echo message="Invoking EGF Pattern Builder on workspace ${workspace}" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.jdt.core.javabuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.ManifestBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.SchemaBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.egf.pattern.ui.PatternBuilder" />
	</target>


    <target name="Platform_Modeler_Step_Build_Plaform_Modeler" depends="init,install.buckminster">
        <echo message="Importing projects into workspace ${workspace} and binaries into target platform" />

		<echo message="install JRE ${env.JAVA_HOME}" />
    	<buckminster command="installJRE">
            <cmdargs>
                <arg value="--location" />
                <arg value="${env.JAVA_HOME}" />
            </cmdargs>
        </buckminster>


		<echo message="import target platform" />
        <buckminster command="importtargetdefinition">
            <cmdargs>
                <arg value="--active" />
                <arg value="${relengDir}/buckminster_Platform_Modeler_Step_Build_Plaform_Modeler/build.target" />
            </cmdargs>
        </buckminster>
		<echo message="provision : import projects in workspace" />
        <buckminster command="import">
            <!-- Uncomment to debug <globargs><jvmarg value="-agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=y"/></globargs> -->
            <cmdargs>
                <arg value="${relengDir}/buckminster_Platform_Modeler_Step_Build_Plaform_Modeler/build.mspec" />
            </cmdargs>
        </buckminster>


        <available file="${tools}/egf/eclipse.ini" property="egf.exists_Platform_Modeler_Step_Build_Plaform_Modeler" />
		<antcall target="recompile_egf_patterns_Platform_Modeler_Step_Build_Plaform_Modeler" />
		
        <echo message="Invoking all eclipse builders on workspace ${workspace}" />
        <buckminster command="build" >
            <cmdargs>
                <arg value="--clean" />
                <arg value="--thorough" />
            </cmdargs>
		</buckminster>
    </target>

	<target name="recompile_egf_patterns_Platform_Modeler_Step_Build_Plaform_Modeler" if="egf.exists_Platform_Modeler_Step_Build_Plaform_Modeler" >
		<anteclipse target="do_recompile_egf_patterns_Platform_Modeler_Step_Build_Plaform_Modeler" />
	</target>

	<target name="do_recompile_egf_patterns_Platform_Modeler_Step_Build_Plaform_Modeler" >
        <echo message="Invoking EGF Pattern Builder on workspace ${workspace}" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.jdt.core.javabuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.ManifestBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.SchemaBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.egf.pattern.ui.PatternBuilder" />
	</target>


    <target name="Platform_GenDoc_Step_Build_Plaform_GenDoc" depends="init,install.buckminster">
        <echo message="Importing projects into workspace ${workspace} and binaries into target platform" />

		<echo message="install JRE ${env.JAVA_HOME}" />
    	<buckminster command="installJRE">
            <cmdargs>
                <arg value="--location" />
                <arg value="${env.JAVA_HOME}" />
            </cmdargs>
        </buckminster>


		<echo message="import target platform" />
        <buckminster command="importtargetdefinition">
            <cmdargs>
                <arg value="--active" />
                <arg value="${relengDir}/buckminster_Platform_GenDoc_Step_Build_Plaform_GenDoc/build.target" />
            </cmdargs>
        </buckminster>
		<echo message="provision : import projects in workspace" />
        <buckminster command="import">
            <!-- Uncomment to debug <globargs><jvmarg value="-agentlib:jdwp=transport=dt_socket,address=8000,server=y,suspend=y"/></globargs> -->
            <cmdargs>
                <arg value="${relengDir}/buckminster_Platform_GenDoc_Step_Build_Plaform_GenDoc/build.mspec" />
            </cmdargs>
        </buckminster>


        <available file="${tools}/egf/eclipse.ini" property="egf.exists_Platform_GenDoc_Step_Build_Plaform_GenDoc" />
		<antcall target="recompile_egf_patterns_Platform_GenDoc_Step_Build_Plaform_GenDoc" />
		
        <echo message="Invoking all eclipse builders on workspace ${workspace}" />
        <buckminster command="build" >
            <cmdargs>
                <arg value="--clean" />
                <arg value="--thorough" />
            </cmdargs>
		</buckminster>
    </target>

	<target name="recompile_egf_patterns_Platform_GenDoc_Step_Build_Plaform_GenDoc" if="egf.exists_Platform_GenDoc_Step_Build_Plaform_GenDoc" >
		<anteclipse target="do_recompile_egf_patterns_Platform_GenDoc_Step_Build_Plaform_GenDoc" />
	</target>

	<target name="do_recompile_egf_patterns_Platform_GenDoc_Step_Build_Plaform_GenDoc" >
        <echo message="Invoking EGF Pattern Builder on workspace ${workspace}" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.jdt.core.javabuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.ManifestBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.pde.SchemaBuilder" />
		<eclipse.incrementalBuild kind="incremental" builder="org.eclipse.egf.pattern.ui.PatternBuilder" />
	</target>


	<target name="Platform_Model_Step_Publish_Platform_Model" depends="init,install.buckminster" >

		
		<echo message="Generate Site"/>
		<buckminster command="perform">
			<globargs>
				<arg value="-Dsite.include.top=true"/>
				<arg value="-Dsite.signing=false"/>				
				<arg value="-Dcbi.include.source=false"/>				
			</globargs>
			<cmdargs>
				<arg value="org.polarsys.kitalpha.pdt.metamodel.feature:eclipse.feature#site.p2" />
			</cmdargs>
		</buckminster>

		<echo message="Publish site"/>
		<mkdir dir="${publish}/org.polarsys.kitalpha.pdt.metamodel.feature/site.p2/"/>
		<copy todir="${publish}/org.polarsys.kitalpha.pdt.metamodel.feature/site.p2/">
			<fileset dir="${result}/output">
				<include name="org.polarsys.kitalpha.pdt.metamodel.feature*/site.p2/*"/>
				<include name="org.polarsys.kitalpha.pdt.metamodel.feature*/site.p2/**"/>
			</fileset>
			<filtermapper>
				<replaceregex pattern=".*site\.p2" replace="" />
			</filtermapper>
		</copy>
		
	</target>

	<target name="Platform_Introspector_Step_Publish_Platform_Introspector" depends="init,install.buckminster" >

		
		<echo message="Generate Site"/>
		<buckminster command="perform">
			<globargs>
				<arg value="-Dsite.include.top=true"/>
				<arg value="-Dsite.signing=false"/>				
				<arg value="-Dcbi.include.source=false"/>				
			</globargs>
			<cmdargs>
				<arg value="org.polarsys.kitalpha.pdt.introspector.feature:eclipse.feature#site.p2" />
			</cmdargs>
		</buckminster>

		<echo message="Publish site"/>
		<mkdir dir="${publish}/org.polarsys.kitalpha.pdt.introspector.feature/site.p2/"/>
		<copy todir="${publish}/org.polarsys.kitalpha.pdt.introspector.feature/site.p2/">
			<fileset dir="${result}/output">
				<include name="org.polarsys.kitalpha.pdt.introspector.feature*/site.p2/*"/>
				<include name="org.polarsys.kitalpha.pdt.introspector.feature*/site.p2/**"/>
			</fileset>
			<filtermapper>
				<replaceregex pattern=".*site\.p2" replace="" />
			</filtermapper>
		</copy>
		
	</target>

	<target name="Platform_Introspector_Step_Publish_Platform_Introspector_UI" depends="init,install.buckminster" >

		
		<echo message="Generate Site"/>
		<buckminster command="perform">
			<globargs>
				<arg value="-Dsite.include.top=true"/>
				<arg value="-Dsite.signing=false"/>				
				<arg value="-Dcbi.include.source=false"/>				
			</globargs>
			<cmdargs>
				<arg value="org.polarsys.kitalpha.pdt.introspector.ui.feature:eclipse.feature#site.p2" />
			</cmdargs>
		</buckminster>

		<echo message="Publish site"/>
		<mkdir dir="${publish}/org.polarsys.kitalpha.pdt.introspector.ui.feature/site.p2/"/>
		<copy todir="${publish}/org.polarsys.kitalpha.pdt.introspector.ui.feature/site.p2/">
			<fileset dir="${result}/output">
				<include name="org.polarsys.kitalpha.pdt.introspector.ui.feature*/site.p2/*"/>
				<include name="org.polarsys.kitalpha.pdt.introspector.ui.feature*/site.p2/**"/>
			</fileset>
			<filtermapper>
				<replaceregex pattern=".*site\.p2" replace="" />
			</filtermapper>
		</copy>
		
	</target>

	<target name="Rotative_Image_Step_Publish_Rotative_Image" depends="init,install.buckminster" >

		
		<echo message="Generate Site"/>
		<buckminster command="perform">
			<globargs>
				<arg value="-Dsite.include.top=true"/>
				<arg value="-Dsite.signing=false"/>				
				<arg value="-Dcbi.include.source=false"/>				
			</globargs>
			<cmdargs>
				<arg value="org.polarsys.kitalpha.common.sirius.extension.rotativeimage.feature:eclipse.feature#site.p2" />
			</cmdargs>
		</buckminster>

		<echo message="Publish site"/>
		<mkdir dir="${publish}/org.polarsys.kitalpha.common.sirius.extension.rotativeimage.feature/site.p2/"/>
		<copy todir="${publish}/org.polarsys.kitalpha.common.sirius.extension.rotativeimage.feature/site.p2/">
			<fileset dir="${result}/output">
				<include name="org.polarsys.kitalpha.common.sirius.extension.rotativeimage.feature*/site.p2/*"/>
				<include name="org.polarsys.kitalpha.common.sirius.extension.rotativeimage.feature*/site.p2/**"/>
			</fileset>
			<filtermapper>
				<replaceregex pattern=".*site\.p2" replace="" />
			</filtermapper>
		</copy>
		
	</target>

	<target name="Platform_Modeler_Step_Publish_Platform_Modeler" depends="init,install.buckminster" >

		
		<echo message="Generate Site"/>
		<buckminster command="perform">
			<globargs>
				<arg value="-Dsite.include.top=true"/>
				<arg value="-Dsite.signing=false"/>				
				<arg value="-Dcbi.include.source=false"/>				
			</globargs>
			<cmdargs>
				<arg value="org.polarsys.kitalpha.pdt.modeler.feature:eclipse.feature#site.p2" />
			</cmdargs>
		</buckminster>

		<echo message="Publish site"/>
		<mkdir dir="${publish}/org.polarsys.kitalpha.pdt.modeler.feature/site.p2/"/>
		<copy todir="${publish}/org.polarsys.kitalpha.pdt.modeler.feature/site.p2/">
			<fileset dir="${result}/output">
				<include name="org.polarsys.kitalpha.pdt.modeler.feature*/site.p2/*"/>
				<include name="org.polarsys.kitalpha.pdt.modeler.feature*/site.p2/**"/>
			</fileset>
			<filtermapper>
				<replaceregex pattern=".*site\.p2" replace="" />
			</filtermapper>
		</copy>
		
	</target>

	<target name="Platform_GenDoc_Step_Publish_Platform_GenDoc_" depends="init,install.buckminster" >

		
		<echo message="Generate Site"/>
		<buckminster command="perform">
			<globargs>
				<arg value="-Dsite.include.top=true"/>
				<arg value="-Dsite.signing=false"/>				
				<arg value="-Dcbi.include.source=false"/>				
			</globargs>
			<cmdargs>
				<arg value="org.polarsys.kitalpha.pdt.docgen.feature:eclipse.feature#site.p2" />
			</cmdargs>
		</buckminster>

		<echo message="Publish site"/>
		<mkdir dir="${publish}/org.polarsys.kitalpha.pdt.docgen.feature/site.p2/"/>
		<copy todir="${publish}/org.polarsys.kitalpha.pdt.docgen.feature/site.p2/">
			<fileset dir="${result}/output">
				<include name="org.polarsys.kitalpha.pdt.docgen.feature*/site.p2/*"/>
				<include name="org.polarsys.kitalpha.pdt.docgen.feature*/site.p2/**"/>
			</fileset>
			<filtermapper>
				<replaceregex pattern=".*site\.p2" replace="" />
			</filtermapper>
		</copy>
		
	</target>

	<target name="Platform_GenDoc_Step_Publish_Platform_GenDoc_UI" depends="init,install.buckminster" >

		
		<echo message="Generate Site"/>
		<buckminster command="perform">
			<globargs>
				<arg value="-Dsite.include.top=true"/>
				<arg value="-Dsite.signing=false"/>				
				<arg value="-Dcbi.include.source=false"/>				
			</globargs>
			<cmdargs>
				<arg value="org.polarsys.kitalpha.pdt.docgen.ui.feature:eclipse.feature#site.p2" />
			</cmdargs>
		</buckminster>

		<echo message="Publish site"/>
		<mkdir dir="${publish}/org.polarsys.kitalpha.pdt.docgen.ui.feature/site.p2/"/>
		<copy todir="${publish}/org.polarsys.kitalpha.pdt.docgen.ui.feature/site.p2/">
			<fileset dir="${result}/output">
				<include name="org.polarsys.kitalpha.pdt.docgen.ui.feature*/site.p2/*"/>
				<include name="org.polarsys.kitalpha.pdt.docgen.ui.feature*/site.p2/**"/>
			</fileset>
			<filtermapper>
				<replaceregex pattern=".*site\.p2" replace="" />
			</filtermapper>
		</copy>
		
	</target>


	<target name="Download_TP_download_TP">
		<antcall target="download_tp"/>
	</target>

<target name="download_tp">
	 <dirname property="dir" file="${publish}/TP.ts"/>
	 <mkdir dir="${dir}" />

	<get 
		src="${TP_URL}/buildTimestamp?format=yyyy-MM-dd_HH-mm-ss" 
		dest="${publish}/TP.ts"/>
	
	<loadfile srcfile="${publish}/TP.ts" property="ts"/>
	<echo>timestamp: ${ts}</echo>

	<get 
		src="${TP_URL}/artifact/result/publish/kitalpha_${kitalpha_version}-${ts}-linux-gtk-x86_64-mars.tar.gz"
		dest="${publish}/TP.tar.gz"/>

	<gunzip src="${publish}/TP.tar.gz"/>
	<untar src="${publish}/TP.tar" dest="${publish}/TP"/>
</target> 

	<target name="Platform_Introspector_Step_Aggregate_Platform_Introspector" depends="init,install.egf" >
		<anteclipse target="Platform_Introspector_Step_Aggregate_Platform_Introspector_dropins" />
		<anteclipse target="Platform_Introspector_Step_Aggregate_Platform_Introspector_sitep2" />
	</target>	

	<target name="Platform_Introspector_Step_Aggregate_Platform_Introspector_dropins">
	</target>	

	<target name="Platform_Introspector_Step_Aggregate_Platform_Introspector_sitep2">
		<!-- see http://wiki.eclipse.org/Equinox/p2/Ant_Tasks -->
		<p2.mirror>
			<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.introspector.packaging/site.p2" name="Introspector/org.polarsys.kitalpha.pdt.introspector.packaging" />
			<source>
				<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.introspector.feature/site.p2" />
				<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.introspector.ui.feature/site.p2" />
			</source>
		</p2.mirror>
	</target>
	<target name="Platform_GenDoc_Step_Aggregate_Platform_DocGen" depends="init,install.egf" >
		<anteclipse target="Platform_GenDoc_Step_Aggregate_Platform_DocGen_dropins" />
		<anteclipse target="Platform_GenDoc_Step_Aggregate_Platform_DocGen_sitep2" />
	</target>	

	<target name="Platform_GenDoc_Step_Aggregate_Platform_DocGen_dropins">
	</target>	

	<target name="Platform_GenDoc_Step_Aggregate_Platform_DocGen_sitep2">
		<!-- see http://wiki.eclipse.org/Equinox/p2/Ant_Tasks -->
		<p2.mirror>
			<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.docgen.packaging/site.p2" name="Introspector/org.polarsys.kitalpha.pdt.docgen.packaging" />
			<source>
			</source>
		</p2.mirror>
	</target>
	<target name="Packaging_All_in_one_All_in_one" depends="init,install.egf" >
		<anteclipse target="Packaging_All_in_one_All_in_one_dropins" />
		<anteclipse target="Packaging_All_in_one_All_in_one_sitep2" />
	</target>	

	<target name="Packaging_All_in_one_All_in_one_dropins">
	</target>	

	<target name="Packaging_All_in_one_All_in_one_sitep2">
		<!-- see http://wiki.eclipse.org/Equinox/p2/Ant_Tasks -->
		<p2.mirror>
			<repository location="file:/${publish}/org.polarsys.kitalpha.pdttooling.packaging/site.p2" name="Introspector/org.polarsys.kitalpha.pdttooling.packaging" />
			<source>
				<repository location="file:/${publish}/org.polarsys.kitalpha.common.sirius.extension.rotativeimage.feature/site.p2" />
				<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.docgen.feature/site.p2" />
				<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.docgen.ui.feature/site.p2" />
				<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.introspector.feature/site.p2" />
				<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.introspector.ui.feature/site.p2" />
				<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.metamodel.feature/site.p2" />
				<repository location="file:/${publish}/org.polarsys.kitalpha.pdt.modeler.feature/site.p2" />
			</source>
		</p2.mirror>
	</target>
	<target name="Clean_Delete_TP" depends="init">
		<delete  >
			<fileset file="${publish}/download/TP.zip"/>
		</delete>
	</target>

	<target name="Clean_Delete_Packaging_Platform_DocGen" depends="init">
		<delete  >

		</delete>
	</target>

	<target name="Clean_Delete_Packaging_Platform_Introspector" depends="init">
		<delete  >

			<fileset dir="${publish}/org.polarsys.kitalpha.pdt.introspector.feature"/>
			<fileset dir="${publish}/org.polarsys.kitalpha.pdt.introspector.ui.feature"/>
		</delete>
	</target>

	<target name="Clean_Delete_Packaging_All_in_one" depends="init">
		<delete  >

			<fileset dir="${publish}/org.polarsys.kitalpha.common.sirius.extension.rotativeimage.feature"/>
			<fileset dir="${publish}/org.polarsys.kitalpha.pdt.docgen.feature"/>
			<fileset dir="${publish}/org.polarsys.kitalpha.pdt.docgen.ui.feature"/>
			<fileset dir="${publish}/org.polarsys.kitalpha.pdt.introspector.feature"/>
			<fileset dir="${publish}/org.polarsys.kitalpha.pdt.introspector.ui.feature"/>
			<fileset dir="${publish}/org.polarsys.kitalpha.pdt.metamodel.feature"/>
			<fileset dir="${publish}/org.polarsys.kitalpha.pdt.modeler.feature"/>
		</delete>
	</target>

	<target name="Clean_Delete_download_folder" depends="init">
		<delete  >

			<fileset dir="${publish}/download"/>
		</delete>
	</target>

	<target name="Clean_Delete_TP_Unzip" depends="init">
		<delete  >

			<fileset dir="${publish}/TP"/>
		</delete>
	</target>

	<target name="Platform_Model_Step_Platform_Model" depends="init">
		<zip destfile="${publish}/platformModel-updateSite-${Kitalpha_Version}_${timestamp}-nosrc.zip" basedir="${publish}/org.polarsys.kitalpha.pdt.metamodel.feature/site.p2"  >

		</zip>
	</target>

	<target name="Platform_Introspector_Step_Platform_Introspector" depends="init">
		<zip destfile="${publish}/platformIntrospector-updateSite-${Kitalpha_Version}_${timestamp}-nosrc.zip" basedir="${publish}/org.polarsys.kitalpha.pdt.introspector.packaging/site.p2"  >

		</zip>
	</target>

	<target name="Platform_Modeler_Step_Platform_Modeler" depends="init">
		<zip destfile="${publish}/platformModeler-updateSite-${Kitalpha_Version}_${timestamp}-nosrc.zip" basedir="${publish}/org.polarsys.kitalpha.pdt.modeler.feature/site.p2"  >

		</zip>
	</target>

	<target name="Platform_GenDoc_Step_Platform_DocGen" depends="init">
		<zip destfile="${publish}/platformDocGen-updateSite-${Kitalpha_Version}_${timestamp}-nosrc.zip" basedir="${publish}/org.polarsys.kitalpha.pdt.docgen.packaging/site.p2"  >

		</zip>
	</target>

	<target name="Packaging_All_in_one_All_in_One" depends="init">
		<zip destfile="${publish}/PDTTooling_Tooling_All-updateSite-${Kitalpha_Version}_${timestamp}-nosrc.zip" basedir="${publish}/org.polarsys.kitalpha.pdttooling.packaging/site.p2"  >

		</zip>
	</target>

	<target name="Download_TP_Create_Folder_download" depends="init">
		<mkdir dir="${publish}/download">
		</mkdir>
	</target>

</project>